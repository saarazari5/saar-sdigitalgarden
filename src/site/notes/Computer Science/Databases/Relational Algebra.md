---
{"dateCreated":"2023-02-18 14:43","tags":["databases"],"pageDirection":"rtl","dg-publish":true,"permalink":"/computer-science/databases/relational-algebra/","dgPassFrontmatter":true}
---


# אלגברה רלציונית
כאשר אנחנו שולחים שאילתה ל[[Computer Science/Databases/Database Management System\|DBMS]] יתקיים שהמנוע מקבל Query Plan. 
השפה הדיקלרטיבית שהיא [[Computer Science/Databases/overview of SQL\|SQL]] היא דרך מילולית לבטא את אוסף הפעולות שהמערכת יודעת לבצע ולעבד. ה Query Compiler הוא זה שמקבל את השאילתות בשפה הדיקלרטיבית ומתרגם אותה ל Query Plans שהם ביטויים יותר פורמליים שהמערכת יודעת להתעסק איתם.

האלגברה הרלצניונית זו בעצם הפורמליזציה של לקיחת קבוצה של טבלאות ובניית טבלה חדשה מהן בהתבסס על ה Query plans. אלו כתובים בשפת האלגברה הרלציונית וה Execution Engine מביא את המידע מבסיס הנתונים באופן הכי יעיל בעזרתם.

נשים לב שכאשר שולחים שאילתה למערכת בסיס הנתונים ישנן מספר דרכים אפשריות שמהם היא יכולה לשלוף את הרלציה המבוקשת של הפלט. התפקיד של מערכת בסיסי הנתונים בין השאר זה לדעת מה השיטה הכי יעילה לבצע שאילתה ובחירה בה על פני דרכים שעלולים לקחת יותר זמן או יותר מאמץ.

## אופרטורים
### union
הסימון זה $\cup$ - עבור טבלאות עם שדה אחד פעולת איחוד תחזיר לנו את שרשור כל הערכים שנמצאים בשתי הטבלאות לטבלה אחת בודדת. 

### Diff
הסימון זה $-$ עבור טבלאות עם שדה אחד בלבד, פעולת חיסור בין $R_{1},R_{2}$ תחזיר רק את הרשומות שנמצאות ב$R_{1}$ ולא ב $R_{2}$ .

### selection 
הסימון זה $\sigma$ והמשמעות היא , החזרת כל הרשומות מטבלה מסויימת שמקיימת תנאי כלשהו. נסמן עבור טבלה $R$ ותנאי $c$ את הבחירה של כל הרשומות בטבלה שמקיימות את התנאי כ $\sigma_{c}(R)$. בחירה היא פעולה שמורידה tuples כלומר שורות מהטבלה

### projection
הסימון זה $\Pi$ והוא מייצג את ההקרנה של טבלה מסויימת לאחר שאילתה כלומר את הטבלה בלי השדות הלא רצויים. הקרנה זאת פעולה שמורידה עמודות מהטבלה. עבור קבוצת שדות $A_{1},\dots,A_{n}$ וטבלה $R$ נסמן $\Pi_{A_{1},\dots, A_{n}}(R)$ כטבלה המוקרנת מ $R$ שבה יש רק את השדות הנ״ל.

### מכפלה קרטזית
פעולה המצמידה רשומה מטבלה אחת לטבלה אחרת $R_{1}\times R_{2}$ כלומר כל הזוגות האפשריים כך שאיבר אחת מ $R_{1}$ והשני מ $R_{2}$.

### intersection
הסימון הוא $\cap$ והוא מיוצג רק את הרשומות המשותפות לשתי טבלאות $R_{1},R_{2}$

### renaming
הסימון הוא $\rho$ והוא מוגדר להיות אופרטור שמשנה רק סכמה של טבלה. 

### distinct
$\delta(R)$ מסמן את השמטת הכפילויות מטבלה $R$

## פעולות JOIN
### Natural Join
מסומן כ $\bowtie$ והוא מבצע join לשתי טבלאות על פי התכונות הזהות שיש לשתיהן מתקיים ש 

$$R_{1}\bowtie R_{2}= \Pi_{A}(\sigma_{C}(R_{1}\times R_{2}))$$

כאשר $\sigma_{c}$ מבצע selection עבור כל התכונות שיש שיוויון בין רשומה מ $R_{1}$ לרשומה מ $R_{2}$ ו $\Pi_{A}$ מבצע הקרנה כך שבטבלה הסופית יש את התכונות $A$ שאלה התכונות משתי הטבלאות בלי כפילויות. כלומר הטבלה הסופית היא טבלה שיש בה את השדות המשותפים לשתי הטבלאות בלי כפילויות __וגם__ את כל התכונות משתי הטבלאות.

למשל עבור

  ID  |  Name
  ----|------
  1   |  John
  2   |  Jane
  3   |  Bill

ו 

  ID  |  Age  |  Gender
  ----|-------|-------
  1   |  25   |  M
  2   |  32   |  F
  4   |  45   |  M

הjoin הטבעי ייתן

  ID  |  Name  |  Age  |  Gender
  ----|--------|-------|-------
  1   |  John  |  25   |  M
  2   |  Jane  |  32   |  F


### Theta Join
$\bowtie_{\theta}$ מייצג הצלבה בין שתי טבלאות על בסיס תנאי כלשהו $c$

$$R_{1}\bowtie_{\theta} R_{2}= \sigma_{c}(R_{1}\times R_{2})$$

כלומר אנחנו רוצים לקחת את שתי הטבלאות ולהשאיר רק את השורות שמקיימות תנאי כלשהו  $c$.

### equijoin
$\bowtie_{A=B}$ מקרה פרטי של theta רק שהפעם התנאי הוא בהכרח תנאי של שיוויון בין שתי תכונות. 

$$R_{1}\bowtie_{A=B} R_{2}= \sigma_{A=B}(R_{1}\times R_{2})$$

__דוגמה__
הפקודה הבאה 

$$\Pi_{buyer}(purchase)$$

לוקחת את הטבלה $purchase$ ומחזירה ממנה רק את עמודת ה buyer שלה.

הפקודה 

$$purchase\bowtie_{buyer=name} person$$

מבצעת join בין שתי הטבלאות לפי עמודת הbuyer והname היכן שיש שיוויון.
כלומר, כמו שהכרנו מפעולות Join של טבלאות ב-SQL ניקח את שני הטבלאות Purchase ו-Person ונייצר כל קומבינציה אפשרית של רשומה מול רשומה מטבלאות אלו, ובסוף נשאיר רק את הרשומות שיש להן ערך זהה בשדה ה-buyer וname לפי העמודות שביקשנו.

כעת ננסה לעשות פקודה מורכבת אף יותר 

$$\Pi_{buyer}(purchase\bowtie_{buyer=name} person)$$

היא עושה Join כפי שהראנו מקודם אבל מבצעת הקרנה רק על עמודת ה buyer
ניתן לראות את שרשרת הפעולות בעץ הבא

![Pasted image 20230218173740.png|350](/img/user/Assets/Pasted%20image%2020230218173740.png)

## קומוטטיביות ואסוציטיביות 
הכללים הבאים מתקיימים 

$$\displaylines{
R\ op\  S = S\ op\ R \ \ \ R \ op\ (S \ op  \ T) = (R \ op\ S)\ op\  T
}$$

כאשר $op\in\{\cup,\cap,\bowtie\}$

כמו כן מתקיימים תנאי הדיסטריבוטיות מתורת הקבוצות על join , כלומר 

$$R\bowtie (S\cup T)= (R\bowtie S)\cup (R\bowtie T)$$

ניתן לדבר גם על הכללים הבאים שנוגעים ל-Selection ומתארים כיצד ניתן לפרק ביטויים עם התניות לביטויים שקולים:

![Pasted image 20230218225234.png](/img/user/Assets/Pasted%20image%2020230218225234.png)

